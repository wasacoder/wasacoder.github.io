---
title: 去繁从简！设计一个最简流程解决方案
date: 2024-12-10 10:04:50
tags:
  - idea
---
刚工作那会，用状态切换流程，上一岗处理后改变状态码，下一岗根据状态码查到自己的待办事项，接着往下推进流程。

后来发现这样不行，每个流程都要写不同的状态码，每个待办、在办、已办查询都要单独写，开发工作量太大。于是引入流程引擎，号称BPM平台，可以画流程模板，有统一的待办查询，有统一的流程提交接口，解决了很多的问题。

但是统一也有统一的问题。
- 依赖问题。应用系统依赖BPM，BPM性能差，应用系统性能就差；BPM不支持的特性，应用系统可能就没法具备。
- 差异化问题。有些应用对流程有特殊的需求，比如点对点退回、批量提交，统一的BPM平台不一定有这些功能，得定制化开发。
- 环境问题。因为BPM平台越来越大，跑的流程越来越多，多个应用系统共用一套环境，如果要单独为某一个应用系统部署一套测试环境，就需要协调BPM平台也增加环境，这通常不那么容易，也需要别的人员支持。

俗话说天下大势分久必合合久必分，在经历长时间的BPM统一平台之后，我又开始想念利用状态来控制流程的日子了。

# 一个极简的流程解决方案
## 有限状态机就挺好
对于业务流程，其实可以简化为一个有限状态机，流程的推进就是状态机的状态切换。我们使用一个有限状态机来建模所有的业务流程。
## 还是得提供统一接口
在状态机的基础上，我们将流程创建、流程提交、流程查询、流程选人等功能开放为统一接口，应用系统使用时，还是像和BPM平台一样打交道，这让我们的流程解决方案具备了一些流程平台的特征，只是它更轻便、更简洁。

## 可扩展的业务信息
必不可少地，业务信息需要与流程引擎相结合，用于流程推进、流程信息展示，我们通过扩展存储来灵活记录流程附带的业务信息，并在流程查询中正常返回业务信息，做到了既与业务系统解耦又具备存数的能力。
## 支持特殊的需求
我们经常需要能够批量提交流程以及点对点退回，因此在自己设计的流程解决方案中就让它原生支持这些需求，不像用BPM平台可能就做不到或者需要自己魔改，这就是自由的好处。

## 选人还是不选人
大多数流程引擎中流程流转到下一节点时，是要求选人或者选人员范围或者选机构的，一旦需要用户选择下一岗人员，就难以实现批量提交。因此，我们的流程解决方案默认不选人，只有业务要求选人时才在流程节点配置需要选人。

## 支持多系统的能力
其实这是一个通用流程解决方案，我们也允许它像一个BPM平台一样可供不同的业务系统接入，这并不难。
## 保持简单
世界上困难的事不是把事情做复杂，而是把事情做得更简单。舍弃大而全的BPM流程平台，做一个最简的流程解决方案，也不奢求支持100%的功能替代，就挺好。比如图形化流程模板设计，这个功能对于程序员来讲，就没啥用，咱就别费力去提供了。

# 效果
从流程从BPM迁移后的运行效果来看，这个方案能够支撑以前BPM平台跑的流程，这就足够了。去繁从简，自己动手，丰衣足食！